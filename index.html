<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¯å¤«æ ¼æ ¼ - é ç´„ä¸‹å–®</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #FDF8F5; 
            margin: 0; 
            padding: 0; 
            -webkit-tap-highlight-color: transparent; 
            color: #5E503F;
            font-size: 16px;
        }
        .animate-fade { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .btn-active:active { transform: scale(0.98); transition: 0.1s; }
        .modal-overlay { background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .warning-pulse { animation: pulseRed 2s infinite; }
        @keyframes pulseRed { 
            0% { background-color: #FEF2F2; } 
            50% { background-color: #FEE2E2; } 
            100% { background-color: #FEF2F2; } 
        }
        input:focus, textarea:focus { 
            background-color: #FFFFFF !important;
            border-color: #D5BDAF !important;
            box-shadow: 0 0 0 4px rgba(213, 189, 175, 0.2);
        }
        input, textarea, select { font-size: 16px !important; }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.35rem;
        }
        .category-btn {
            word-break: keep-all;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 0.25rem;
            text-align: center;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        const extraNames = { cream: 'ä¸åŠ é®®å¥¶æ²¹', bag: 'åŠ è³¼æè¢‹', receipt: 'æ‰‹é–‹æ”¶æ“š', sugar: 'ä¸åŠ ç³–ç²‰', fork: 'åŠ å‰å­' };
        const cardNames = { none: 'ä¸éœ€è¦', birthday: 'ç”Ÿæ—¥å¡', xmas: 'è–èª•å¡' };
        const bankInfo = { bankName: "ä¸­åœ‹ä¿¡è¨— (822)", accountName: "å½­æ°¸ç¿”", accountNumber: "1755 4046 3472" };
        const storeAddress = "æ¡ƒåœ’å¸‚æ¡ƒåœ’å€æ–‡ä¸­äºŒè·¯25å··22è™Ÿ";
        const officialLineUrl = "https://lin.ee/jCQGkr1";
        const CUSTOM_NOTE = "æ­¤ç”¢å“çš†ç‚ºå®¢è£½åŒ–éœ€æå‰ä¸‰å¤©é è¨‚";

        const productCategories = {
            'ç¾çƒ¤å¤–å¸¶8å…¥': [
                { id: '8_orig', label: '8å…¥ åŸå‘³', price: 75, minLimit: false },
                { id: '8_straw', label: '8å…¥ è‰è“', price: 95, minLimit: false },
                { id: '8_cocoa', label: '8å…¥ å¯å¯', price: 75, minLimit: false },
                { id: '8_matcha', label: '8å…¥ æŠ¹èŒ¶', price: 80, minLimit: false },
            ],
            'é›™è‰²4å…¥': [
                { id: '4_orig', label: '4å…¥ åŸå‘³', price: 45, minLimit: true, note: CUSTOM_NOTE },
                { id: '4_straw', label: '4å…¥ è‰è“', price: 60, minLimit: true, note: CUSTOM_NOTE },
                { id: '4_cocoa', label: '4å…¥ å¯å¯', price: 50, minLimit: true, note: CUSTOM_NOTE },
                { id: '4_matcha', label: '4å…¥ æŠ¹èŒ¶', price: 55, minLimit: true, note: CUSTOM_NOTE },
                { id: '4_os', label: 'åŸå‘³ + è‰è“', price: 60, minLimit: true, note: CUSTOM_NOTE },
                { id: '4_oc', label: 'åŸå‘³ + å¯å¯', price: 50, minLimit: true, note: CUSTOM_NOTE },
                { id: '4_om', label: 'åŸå‘³ + æŠ¹èŒ¶', price: 55, minLimit: true, note: CUSTOM_NOTE },
                { id: '4_sc', label: 'è‰è“ + å¯å¯', price: 60, minLimit: true, note: CUSTOM_NOTE },
                { id: '4_sm', label: 'è‰è“ + æŠ¹èŒ¶', price: 65, minLimit: true, note: CUSTOM_NOTE },
                { id: '4_cm', label: 'å¯å¯ + æŠ¹èŒ¶', price: 60, minLimit: true, note: CUSTOM_NOTE },
            ],
            'ç¶œåˆ': [
                { id: '8_mix', label: '8å…¥ å››è‰²ç¶œåˆ', price: 110, minLimit: true, note: CUSTOM_NOTE },
                { id: '4_mix', label: '4å…¥ å››è‰²ç¶œåˆ', price: 65, minLimit: true, note: CUSTOM_NOTE },
            ],
            'çœŸç©ºåŒ…': [
                { id: 'v_40_o', label: 'çœŸç©º40 åŸå‘³', price: 320, vType: 40, note: CUSTOM_NOTE },
                { id: 'v_40_s', label: 'çœŸç©º40 è‰è“', price: 500, vType: 40, note: CUSTOM_NOTE },
                { id: 'v_40_c', label: 'çœŸç©º40 å¯å¯', price: 385, vType: 40, note: CUSTOM_NOTE },
                { id: 'v_40_m', label: 'çœŸç©º40 æŠ¹èŒ¶', price: 380, vType: 40, note: CUSTOM_NOTE },
                { id: 'v_80_o', label: 'çœŸç©º80 åŸå‘³', price: 550, vType: 80, note: CUSTOM_NOTE },
                { id: 'v_80_s', label: 'çœŸç©º80 è‰è“', price: 790, vType: 80, note: CUSTOM_NOTE },
                { id: 'v_80_c', label: 'çœŸç©º80 å¯å¯', price: 700, vType: 80, note: CUSTOM_NOTE },
                { id: 'v_80_m', label: 'çœŸç©º80 æŠ¹èŒ¶', price: 750, vType: 80, note: CUSTOM_NOTE },
            ]
        };

        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                plus: <path d="M12 5v14M5 12h14" />,
                minus: <path d="M5 12h14" />,
                check: <polyline points="20 6 9 17 4 12"/>,
                alert: <g><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></g>,
                copy: <g><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></g>,
                clock: <g><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></g>,
                pin: <g><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></g>,
                info: <g><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></g>,
                gift: <g><polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></g>,
                calendar: <g><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></g>,
                chevron: <polyline points="9 18 15 12 9 6" />,
                truck: <g><rect x="1" y="3" width="15" height="13" rx="2" ry="2"/><path d="M16 8h4l4 4v5h-8z"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></g>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        const App = () => {
            const [order, setOrder] = useState({
                name: '', phone: '', address: '', unitName: '', taxId: '', pickupTime: '',
                deliveryMethod: 'è‡ªå–', paymentMethod: 'åº—å…§çµå¸³', cardType: 'none',
                items: [], extras: { cream: false, bag: true, receipt: false, sugar: false, fork: false }, note: ''
            });
            const [category, setCategory] = useState('ç¾çƒ¤å¤–å¸¶8å…¥');
            const [showConfirm, setShowConfirm] = useState(false);
            const [message, setMessage] = useState(null); 
            const [showTimePicker, setShowTimePicker] = useState(false);

            const dateOptions = useMemo(() => {
                const dates = [];
                for (let i = 0; i < 14; i++) {
                    const d = new Date();
                    d.setDate(d.getDate() + i);
                    const label = i === 0 ? "ä»Šå¤©" : i === 1 ? "æ˜å¤©" : `${d.getMonth() + 1}/${d.getDate()}`;
                    const weekday = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"][d.getDay()];
                    const fullDate = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
                    dates.push({ label, weekday, fullDate, index: i });
                }
                return dates;
            }, []);

            const timeOptions = useMemo(() => {
                const times = [];
                for (let h = 10; h <= 19; h++) {
                    times.push(`${String(h).padStart(2, '0')}:00`);
                    if (h < 19) times.push(`${String(h).padStart(2, '0')}:30`);
                }
                return times;
            }, []);

            const [selectedDate, setSelectedDate] = useState(dateOptions[0].fullDate);
            const [selectedTime, setSelectedTime] = useState("");

            // æ ¸å¿ƒæ™ºæ…§åŒ…è£é‚è¼¯
            const packing = useMemo(() => {
                let large = 0, small = 0;
                order.items.forEach(i => {
                    // æ ¹æ“šç”¢å“å…§å®¹å€åˆ†å¤§å°ç›’
                    if (i.id.includes('8_')) large += i.qty;
                    else if (i.id.includes('4_')) small += i.qty;
                });
                
                let b6 = 0, b4 = 0;
                let tL = large, tS = small;
                
                // æ™ºæ…§åˆ†é…ç®—æ³•ï¼šå„ªå…ˆå¡«æ»¿ 6 æ¯è¢‹ (å¯æ”¾ 9 å€‹ 8å…¥ æˆ– 12 å€‹ 4å…¥)
                while (tL >= 9 || tS >= 12) { 
                    b6++; 
                    tL = Math.max(0, tL - 9); 
                    tS = Math.max(0, tS - 12); 
                }
                // å‰©ä¸‹çš„å°æ•£å–®åˆ†é…åˆ° 4 æ¯è¢‹ (å¯æ”¾ 5 å€‹ 8å…¥ æˆ– 6 å€‹ 4å…¥)
                while (tL > 0 || tS > 0) { 
                    b4++; 
                    tL = Math.max(0, tL - 5); 
                    tS = Math.max(0, tS - 6); 
                }
                
                const hasVacuum = order.items.some(i => i.vType);
                return { b6, b4, cooler: hasVacuum ? 1 : 0 };
            }, [order.items]);

            const limitItemsQty = useMemo(() => {
                return order.items
                    .filter(i => i.minLimit)
                    .reduce((s, i) => s + i.qty, 0);
            }, [order.items]);

            const hasLimitWarning = limitItemsQty > 0 && limitItemsQty < 20;

            const totalAmount = useMemo(() => {
                const itemsSum = order.items.reduce((s, i) => s + (i.price * i.qty), 0);
                const bagSum = order.extras.bag ? (packing.b6 + packing.b4) * 2 : 0;
                return itemsSum + bagSum;
            }, [order.items, order.extras.bag, packing]);

            const handleAddItem = (p) => {
                const exist = order.items.find(i => i.id === p.id);
                if (exist) {
                    setOrder({...order, items: order.items.map(i => i.id === p.id ? {...i, qty: i.qty + 1} : i)});
                } else {
                    setOrder({...order, items: [...order.items, {...p, qty: 1}]});
                }
            };

            const handleUpdateQty = (id, newQty) => {
                const qty = parseInt(newQty) || 0;
                if (qty <= 0) {
                    setOrder({ ...order, items: order.items.filter(it => it.id !== id) });
                } else {
                    setOrder({ ...order, items: order.items.map(it => it.id === id ? { ...it, qty } : it) });
                }
            };

            const validateAndShowConfirm = () => {
                if (!order.name.trim()) { setMessage("è«‹å¡«å¯«æ‚¨çš„ã€å§“åã€‘"); return; }
                if (!order.phone.trim()) { setMessage("è«‹å¡«å¯«æ‚¨çš„ã€è¯çµ¡é›»è©±ã€‘"); return; }
                if (!order.pickupTime) { setMessage("è«‹é¸æ“‡ã€é ç´„æ™‚é–“ã€‘"); return; }
                if (order.deliveryMethod === 'å¤–é€' && !order.address.trim()) { setMessage("é¸æ“‡å¤–é€è«‹å¡«å¯«ã€é…é€åœ°å€ã€‘"); return; }
                if (order.items.length === 0) { setMessage("å°šæœªé¸æ“‡ä»»ä½•ã€ç”¢å“ã€‘"); return; }
                if (hasLimitWarning) {
                    setMessage(`é›™è‰²4å…¥åŠç¶œåˆç³»åˆ—ç›®å‰å…±é»è³¼ ${limitItemsQty} ç›’ï¼Œé‚„å·® ${20-limitItemsQty} ç›’æ‰èƒ½æˆç«‹è¨‚å–®å–”ï¼è«‹å†é¸è³¼æ›´å¤šã€‚`);
                    return;
                }
                setShowConfirm(true);
            };

            const handleCopyAndSubmit = () => {
                let itemsText = order.items.map(i => `â€¢ ${i.label} x ${i.qty} = $${i.price * i.qty}`).join('\n');
                let extrasArr = Object.entries(order.extras).filter(([k,v]) => v && k !== 'bag').map(([k]) => extraNames[k]);
                let extras = extrasArr.join('ã€');
                
                // æ™ºæ…§æè¢‹è¤‡è£½æ–‡å­—
                let bagText = "";
                if (order.extras.bag && (packing.b6 > 0 || packing.b4 > 0)) {
                    bagText = `\n--------------------\nã€æè¢‹è²»ç”¨ $2/å€‹ã€‘`;
                    if (packing.b6 > 0) bagText += `\nâ€¢ 6æ¯è¢‹ x ${packing.b6} = $${packing.b6 * 2}`;
                    if (packing.b4 > 0) bagText += `\nâ€¢ 4æ¯è¢‹ x ${packing.b4} = $${packing.b4 * 2}`;
                }
                
                let coolerText = packing.cooler > 0 ? `\nâ€¢ ğŸ çœŸç©ºåŒ…è´ˆé€ä¿å†·è¢‹ x ${packing.cooler} å€‹` : '';
                let cardText = order.cardType !== 'none' ? `\nâ€¢ è£é£¾å°å¡ï¼š${cardNames[order.cardType]}` : '';
                
                const text = `ã€è¯å¤«æ ¼æ ¼ - é ç´„ä¸‹å–®ã€‘\nå®¢æˆ¶ï¼š${order.name}\nå–®ä½ï¼š${order.unitName || 'ç„¡'}\né›»è©±ï¼š${order.phone}\né ç´„æ™‚é–“ï¼š${order.pickupTime.replace('T', ' ')}\né…é€æ–¹å¼ï¼š${order.deliveryMethod}\nä»˜æ¬¾æ–¹å¼ï¼š${order.paymentMethod}\n${order.address ? 'åœ°å€ï¼š'+order.address : (order.deliveryMethod === 'è‡ªå–' ? 'åº—å–ï¼š' + storeAddress : '')}\n--------------------\n${itemsText}${extras ? '\nâ€¢ åŠ è³¼ï¼š' + extras : ''}${cardText}${order.taxId ? '\nâ€¢ çµ±ç·¨ï¼š' + order.taxId : ''}${bagText}${coolerText}\n--------------------\nğŸ’° ç¸½é‡‘é¡ï¼š$ ${totalAmount}\nå‚™è¨»ï¼š${order.note || 'ç„¡'}\n\nå·²æˆåŠŸè¤‡è£½ï¼Œå›å‚³ LINE å³å¯å®Œæˆé å®šã€‚`;
                
                const t = document.createElement("textarea");
                t.value = text;
                t.style.position = "fixed";
                t.style.opacity = "0";
                document.body.appendChild(t);
                t.select();
                t.setSelectionRange(0, 99999);
                try { document.execCommand('copy'); } catch (err) {}
                document.body.removeChild(t);

                setMessage({
                    title: "è¤‡è£½æˆåŠŸï¼",
                    content: "è¨‚å–®å…§å®¹å·²å­˜å…¥å‰ªè²¼ç°¿ã€‚è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å‰å¾€ LINE ä¸¦è²¼ä¸Šè¨Šæ¯ã€‚",
                    isExport: true
                });

                setTimeout(() => { window.location.href = officialLineUrl; }, 1500);
            };

            return (
                <div className="min-h-screen pb-24 text-left">
                    {message && (
                        <div className="fixed inset-0 z-[100] modal-overlay flex items-center justify-center p-6 animate-fade">
                            <div className="bg-white rounded-[2.5rem] w-full max-w-sm shadow-2xl p-10 space-y-6 text-center border border-[#F5EBE0]">
                                <Icon name={message.isExport ? "check" : "info"} size={48} className={message.isExport ? "text-green-500 mx-auto" : "text-[#D5BDAF] mx-auto"} />
                                <h3 className="text-xl font-black text-[#5E503F]">{message.title || "æç¤º"}</h3>
                                <p className="text-base font-bold text-gray-500 leading-relaxed">{message.content || message}</p>
                                <div className="pt-2 flex flex-col gap-3">
                                    {message.isExport && (
                                        <a href={officialLineUrl} className="w-full bg-[#06C755] text-white py-4 rounded-2xl font-black text-base shadow-md flex items-center justify-center gap-2 btn-active">
                                            æ‰‹å‹•é–‹å•Ÿ LINE
                                        </a>
                                    )}
                                    <button onClick={() => {setMessage(null); if(message.isExport) setShowConfirm(false);}} className="w-full bg-[#F9F6F4] text-[#8E7D6F] py-4 rounded-2xl font-black text-base btn-active">
                                        {message.isExport ? "å®Œæˆä¸¦é—œé–‰" : "ç¢ºå®š"}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showTimePicker && (
                        <div className="fixed inset-0 z-[80] modal-overlay flex items-end justify-center p-0 animate-fade">
                            <div className="bg-white w-full rounded-t-[3rem] shadow-2xl overflow-hidden max-w-2xl border-t border-[#F5EBE0]">
                                <div className="p-8 space-y-6">
                                    <div className="flex justify-between items-center">
                                        <div>
                                            <h3 className="text-2xl font-black text-[#8E7D6F]">é ç´„é…é€æ™‚é–“</h3>
                                            <p className="text-xs text-gray-400 font-bold mt-1">è«‹é¸æ“‡é è¨ˆå–è²¨æˆ–é€é”çš„æ™‚æ®µ</p>
                                        </div>
                                        <button onClick={() => setShowTimePicker(false)} className="bg-[#FDF8F5] p-3 rounded-full text-[#D5BDAF] btn-active"><Icon name="close" size={24} /></button>
                                    </div>
                                    <div className="space-y-3">
                                        <p className="text-xs font-black text-[#D5BDAF] uppercase tracking-widest flex items-center gap-2"><Icon name="calendar" size={14}/> é¸æ“‡æ—¥æœŸ</p>
                                        <div className="flex gap-3 overflow-x-auto pb-4 no-scrollbar">
                                            {dateOptions.map(d => (
                                                <button key={d.fullDate} onClick={() => setSelectedDate(d.fullDate)} className={`flex-shrink-0 w-20 py-4 rounded-3xl flex flex-col items-center justify-center transition-all border-2 ${selectedDate === d.fullDate ? 'bg-[#8E7D6F] border-[#8E7D6F] text-white' : 'bg-white border-[#FDF8F5] text-[#8E7D6F]'}`}>
                                                    <span className="text-[10px] font-black mb-1">é€±{d.weekday}</span>
                                                    <span className="text-lg font-black">{d.label}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="space-y-4">
                                        <p className="text-xs font-black text-[#D5BDAF] uppercase tracking-widest flex items-center gap-2"><Icon name="clock" size={14}/> é¸æ“‡æ™‚æ®µ</p>
                                        <div className="grid grid-cols-4 gap-2 max-h-[30vh] overflow-y-auto pr-2 no-scrollbar">
                                            {timeOptions.map(t => (
                                                <button key={t} onClick={() => setSelectedTime(t)} className={`py-4 rounded-2xl font-black text-sm transition-all border-2 ${selectedTime === t ? 'bg-[#D5BDAF] border-[#D5BDAF] text-white' : 'bg-[#F9F6F4] border-transparent text-[#8E7D6F]'}`}>{t}</button>
                                            ))}
                                        </div>
                                    </div>
                                    <button onClick={() => { if (selectedDate && selectedTime) { setOrder({...order, pickupTime: `${selectedDate}T${selectedTime}`}); setShowTimePicker(false); } }} className={`w-full py-6 rounded-[2rem] font-black text-xl shadow-xl transition-all btn-active ${(!selectedDate || !selectedTime) ? 'bg-gray-100 text-gray-300' : 'bg-[#8E7D6F] text-white'}`}>ç¢ºèªé¸æ“‡</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <header className="bg-white p-10 text-center shadow-sm rounded-b-[4rem] mb-10 border-b border-[#F5EBE0]">
                        <h1 className="text-5xl font-black text-[#8E7D6F] tracking-widest mb-3">è¯å¤«æ ¼æ ¼</h1>
                        <p className="text-2xl text-[#D5BDAF] font-black tracking-widest">æ¯”åˆ©æ™‚çç ç³–é¬†é¤…</p>
                        <p className="text-lg text-[#D5BDAF] uppercase font-black tracking-widest mt-3 border-t border-[#F5EBE0] pt-3 inline-block">è¨‚è³¼ç³»çµ±</p>
                    </header>

                    <main className="px-4 space-y-10 max-w-2xl mx-auto">
                        {hasLimitWarning && (
                            <div className="bg-red-50 border-2 border-red-200 p-6 rounded-3xl flex items-center gap-5 warning-pulse animate-fade shadow-sm">
                                <Icon name="alert" size={32} className="text-red-500 flex-shrink-0" />
                                <div className="flex-1">
                                    <p className="text-lg font-black text-red-600">è¨‚è³¼ç›’æ•¸ä¸è¶³</p>
                                    <p className="text-base font-bold text-red-500 opacity-90">é›™è‰²4å…¥èˆ‡ç¶œåˆç³»åˆ—å…±éœ€æ»¿ 20 ç›’ (ç›®å‰åƒ… {limitItemsQty} ç›’)ã€‚</p>
                                </div>
                            </div>
                        )}

                        <section className="bg-white rounded-[3rem] p-10 shadow-md space-y-8 border border-[#F5EBE0]">
                            <h2 className="font-black text-[#8E7D6F] flex items-center gap-3 text-xl border-b border-[#FDF8F5] pb-4">â¶ å®¢æˆ¶åŸºæœ¬è³‡æ–™</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-3">
                                    <p className="text-sm font-black text-[#8E7D6F] uppercase">å§“å <span className="text-red-400">*</span></p>
                                    <input type="text" placeholder="æ‚¨çš„ç¨±å‘¼" className="w-full bg-[#F9F6F4] rounded-2xl p-5 outline-none font-bold text-lg border-2 border-transparent" value={order.name} onChange={e => setOrder({...order, name: e.target.value})} />
                                </div>
                                <div className="space-y-3">
                                    <p className="text-sm font-black text-[#8E7D6F] uppercase">è¯çµ¡é›»è©± <span className="text-red-400">*</span></p>
                                    <input type="tel" placeholder="é›»è©±è™Ÿç¢¼" className="w-full bg-[#F9F6F4] rounded-2xl p-5 outline-none font-bold text-lg border-2 border-transparent" value={order.phone} onChange={e => setOrder({...order, phone: e.target.value})} />
                                </div>
                            </div>
                            <div className="space-y-3">
                                <p className="text-sm font-black text-[#8E7D6F] uppercase">é ç´„å–è²¨ / é…é€æ™‚é–“ <span className="text-red-400">*</span></p>
                                <button onClick={() => setShowTimePicker(true)} className="w-full bg-[#F9F6F4] rounded-[2rem] p-6 flex items-center justify-between group btn-active border-2 border-transparent shadow-inner">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-white p-3 rounded-2xl text-[#8E7D6F] shadow-sm"><Icon name="clock" size={24}/></div>
                                        <div className="text-left">
                                            <p className={`text-xl font-black ${order.pickupTime ? 'text-[#8E7D6F]' : 'text-gray-400'}`}>{order.pickupTime ? order.pickupTime.replace('T', ' ') : 'é»æ“Šé¸æ“‡é ç´„æ™‚é–“'}</p>
                                        </div>
                                    </div>
                                    <Icon name="chevron" size={20} className="text-[#D5BDAF]" />
                                </button>
                            </div>
                            <div className="flex bg-[#F9F6F4] rounded-[2rem] p-2 font-bold shadow-inner">
                                {['è‡ªå–', 'å¤–é€'].map(m => (
                                    <button key={m} onClick={() => setOrder({...order, deliveryMethod: m})} className={`flex-1 py-4 rounded-[1.5rem] transition-all ${order.deliveryMethod === m ? 'bg-[#8E7D6F] text-white shadow-lg' : 'text-[#8E7D6F]'}`}>{m}</button>
                                ))}
                            </div>
                            {order.deliveryMethod === 'è‡ªå–' && (
                                <div className="bg-orange-50 p-6 rounded-3xl border-2 border-orange-100 flex items-start gap-4 animate-fade">
                                    <Icon name="pin" size={24} className="text-orange-400 mt-0.5" />
                                    <div className="flex-1"><p className="text-sm font-black text-orange-600 uppercase">åº—å–åœ°å€</p><p className="text-lg font-bold text-orange-500 opacity-90 leading-relaxed">{storeAddress}</p></div>
                                </div>
                            )}
                            <div className="grid grid-cols-1 gap-6">
                                <div className="space-y-3">
                                    <p className="text-sm font-black text-[#8E7D6F] uppercase">å…¬å¸ / å–®ä½åç¨± (é¸å¡«)</p>
                                    <input type="text" placeholder="å–®ä½åç¨±" className="w-full bg-[#F9F6F4] rounded-2xl p-5 outline-none font-bold text-lg border-2 border-transparent" value={order.unitName} onChange={e => setOrder({...order, unitName: e.target.value})} />
                                </div>
                                <div className="space-y-3">
                                    <p className="text-sm font-black text-[#8E7D6F] uppercase">è©³ç´°é…é€åœ°å€ {order.deliveryMethod === 'å¤–é€' && <span className="text-red-400">*</span>}</p>
                                    <textarea placeholder={order.deliveryMethod === 'è‡ªå–' ? 'è‡ªå–å…å¡«åœ°å€' : 'è©³ç´°é…é€åœ°å€ *'} disabled={order.deliveryMethod === 'è‡ªå–'} className="w-full bg-[#F9F6F4] rounded-2xl p-5 outline-none font-bold text-lg disabled:opacity-30 border-2 border-transparent min-h-[100px]" value={order.address} onChange={e => setOrder({...order, address: e.target.value})}></textarea>
                                </div>
                            </div>
                        </section>

                        <section className="bg-white rounded-[3rem] p-10 shadow-md space-y-8 border border-[#F5EBE0]">
                            <h2 className="font-black text-[#8E7D6F] text-xl border-b border-[#FDF8F5] pb-4">â· é¸æ“‡å£å‘³å…§å®¹</h2>
                            <div className="category-grid font-black">
                                {Object.keys(productCategories).map(cat => (
                                    <button key={cat} onClick={()=>setCategory(cat)} className={`category-btn rounded-2xl transition-all border-2 leading-none ${category===cat?'bg-[#8E7D6F] border-[#8E7D6F] text-white shadow-md' : 'bg-white border-[#E3D5CA] text-[#8E7D6F]'}`}>
                                        <span className="text-[12px] md:text-[14px] mb-1">{cat}</span>
                                        {(cat === 'é›™è‰²4å…¥' || cat === 'ç¶œåˆ') && <span className="mt-1 text-[8px] bg-red-100 text-red-500 px-1 rounded-full">20ç›’èµ·</span>}
                                    </button>
                                ))}
                            </div>
                            <div className="grid grid-cols-1 gap-4">
                                {productCategories[category].map(p => (
                                    <button key={p.id} onClick={() => handleAddItem(p)} className="p-6 bg-[#F9F6F4] rounded-3xl border-2 border-transparent hover:border-[#D5BDAF] btn-active flex justify-between items-center shadow-sm">
                                        <div className="flex-1 pr-4">
                                            {p.note && <span className="bg-[#D5BDAF] text-white text-[10px] px-3 py-1 rounded-full font-black mb-2 block w-fit shadow-sm">{p.note}</span>}
                                            <p className="text-xl font-black">{p.label}</p>
                                        </div>
                                        <p className="text-lg text-[#8E7D6F] font-black">$ {p.price}</p>
                                    </button>
                                ))}
                            </div>

                            {order.items.length > 0 && (
                                <div className="space-y-4 mt-6 pt-8 border-t border-dashed border-[#D5BDAF]/30 animate-fade">
                                    <p className="text-sm font-black text-[#D5BDAF] mb-2 uppercase tracking-widest">ğŸ›’ å·²é¸æ“‡è³¼ç‰©æ¸…å–® (æ‰‹å‹•è¼¸å…¥æ•¸é‡)</p>
                                    <div className="grid grid-cols-1 gap-3">
                                        {order.items.map(i => (
                                            <div key={i.id} className="flex justify-between items-center text-lg font-black bg-[#FDF8F5] p-5 rounded-3xl border border-[#F5EBE0] shadow-sm">
                                                <div className="flex-1">
                                                    <span className="block">{i.label}</span>
                                                    {i.note && <span className="text-[10px] text-orange-400 font-bold">å®¢è£½åŒ–é å®šé …</span>}
                                                </div>
                                                <div className="flex items-center gap-4">
                                                    <button onClick={() => handleUpdateQty(i.id, i.qty - 1)} className="bg-white text-[#D5BDAF] p-3 rounded-xl shadow-sm border border-[#F5EBE0] active:scale-110"><Icon name="minus" size={20}/></button>
                                                    <input type="number" value={i.qty} onChange={(e) => handleUpdateQty(i.id, e.target.value)} className="w-16 text-center text-2xl font-black bg-transparent border-b-2 border-[#D5BDAF]/30 focus:border-[#D5BDAF] outline-none" />
                                                    <button onClick={() => handleUpdateQty(i.id, i.qty + 1)} className="bg-white text-[#D5BDAF] p-3 rounded-xl shadow-sm border border-[#F5EBE0] active:scale-110"><Icon name="plus" size={20}/></button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* æ™ºæ…§è¢‹å­å»ºè­°å€ - ç•¶æœ‰å“é …æ™‚é¡¯ç¤º */}
                                    {order.extras.bag && (packing.b6 > 0 || packing.b4 > 0) && (
                                        <div className="bg-[#D5BDAF]/10 border-2 border-dashed border-[#D5BDAF] p-6 rounded-[2rem] mt-6 animate-fade shadow-inner">
                                            <p className="text-sm font-black text-[#8E7D6F] flex items-center gap-2 uppercase mb-3 tracking-widest">
                                                <Icon name="truck" size={16}/> æ™ºæ…§åŒ…è£æè¢‹å»ºè­°
                                            </p>
                                            <div className="space-y-2">
                                                {packing.b6 > 0 && <div className="flex justify-between text-base font-black"><span>å°ˆç”¨ 6 æ¯è¢‹ ($2)</span><span>x {packing.b6} å€‹</span></div>}
                                                {packing.b4 > 0 && <div className="flex justify-between text-base font-black"><span>å°ˆç”¨ 4 æ¯è¢‹ ($2)</span><span>x {packing.b4} å€‹</span></div>}
                                                <div className="text-[10px] text-[#8E7D6F] opacity-70 mt-2 font-bold leading-tight">* æ ¹æ“šé»è³¼ç”¢å“å¤§å°è‡ªå‹•æ›ç®—ï¼Œç¢ºä¿åŒ…è£ç²¾æº–ã€‚</div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </section>

                        <section className="bg-white rounded-[3rem] p-10 shadow-md space-y-8 border border-[#F5EBE0]">
                            <h2 className="font-black text-[#8E7D6F] text-xl border-b border-[#FDF8F5] pb-4">â¸ ä»˜æ¬¾èˆ‡å‚™è¨»</h2>
                            <div className="space-y-4 pt-2">
                                <p className="text-sm font-black text-[#8E7D6F] flex items-center gap-2 uppercase tracking-widest"><Icon name="gift" size={16}/> æ˜¯å¦éœ€è¦è£é£¾å°å¡ (äºŒæ“‡ä¸€)</p>
                                <div className="grid grid-cols-3 gap-2">
                                    {Object.entries(cardNames).map(([k, label]) => (
                                        <button key={k} onClick={() => setOrder({...order, cardType: k})} className={`py-3 rounded-xl border-2 font-bold text-sm transition-all ${order.cardType === k ? 'bg-[#D5BDAF] border-[#D5BDAF] text-white shadow-md' : 'bg-[#F9F6F4] border-transparent text-[#8E7D6F]'}`}>{label}</button>
                                    ))}
                                </div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-base font-black">
                                {Object.entries(extraNames).map(([k, label]) => (
                                    <button key={k} onClick={() => setOrder({...order, extras: {...order.extras, [k]: !order.extras[k]}})} className={`p-5 rounded-3xl border-2 transition-all flex justify-between items-center ${order.extras[k] ? 'bg-[#D5BDAF] border-[#D5BDAF] text-white shadow-lg' : 'bg-[#F9F6F4] border-transparent text-[#8E7D6F]'}`}>
                                        <span className="text-lg">{label}</span>
                                        {order.extras[k] && <Icon name="check" size={20}/>}
                                    </button>
                                ))}
                            </div>
                            {order.extras.receipt && (
                                <div className="animate-fade space-y-3">
                                    <p className="text-sm font-black text-[#8E7D6F] ml-1 uppercase">çµ±ä¸€ç·¨è™Ÿ</p>
                                    <input type="text" placeholder="è«‹è¼¸å…¥çµ±ä¸€ç·¨è™Ÿ" className="w-full bg-[#F9F6F4] rounded-2xl p-5 outline-none font-bold text-lg border-2 border-transparent" value={order.taxId} onChange={e => setOrder({...order, taxId: e.target.value})} />
                                </div>
                            )}
                            <div className="flex bg-[#F9F6F4] rounded-[2rem] p-2 font-bold shadow-inner mt-4">
                                {['åº—å…§çµå¸³', 'LinePay', 'åŒ¯æ¬¾'].map(m => (
                                    <button key={m} onClick={() => setOrder({...order, paymentMethod: m})} className={`flex-1 py-4 rounded-[1.5rem] transition-all ${order.paymentMethod === m ? 'bg-[#8E7D6F] text-white shadow-lg' : 'text-[#8E7D6F]'}`}>{m}</button>
                                ))}
                            </div>
                            <div className="space-y-3 pt-4">
                                <p className="text-sm font-black text-[#8E7D6F] uppercase">ç‰¹åˆ¥å‚™è¨»äº‹é …</p>
                                <textarea placeholder="æ˜¯å¦æœ‰å£æ„Ÿåå¥½æˆ–ç‰¹æ®Šé…é€éœ€æ±‚ï¼Ÿ" className="w-full bg-[#F9F6F4] rounded-2xl p-5 outline-none font-bold text-lg min-h-[150px] border-2 border-transparent" value={order.note} onChange={e => setOrder({...order, note: e.target.value})}></textarea>
                            </div>
                        </section>

                        <div className="sticky bottom-6 z-40 px-2 py-4">
                            <button onClick={validateAndShowConfirm} className="w-full bg-[#8E7D6F] text-white p-8 rounded-[3rem] font-black text-3xl shadow-2xl flex justify-between items-center px-12 btn-active active:scale-95 transition-all">
                                <span className="tracking-widest">ç¢ºèªé ç´„ä¸‹å–®</span>
                                <span className="bg-white/20 px-6 py-2 rounded-full text-xl font-black">$ {totalAmount}</span>
                            </button>
                        </div>
                    </main>

                    {showConfirm && (
                        <div className="fixed inset-0 z-[60] modal-overlay flex items-center justify-center p-4 animate-fade">
                            <div className="bg-white w-full max-w-xl rounded-[4rem] shadow-2xl border border-[#F5EBE0]">
                                <div className="p-12 space-y-10 max-h-[85vh] overflow-y-auto no-scrollbar">
                                    <div className="text-center">
                                        <h3 className="text-3xl font-black text-[#8E7D6F]">é ç´„æ¸…å–®æ ¸å°</h3>
                                        <p className="text-sm opacity-40 mt-1 uppercase tracking-[0.2em] font-black">Final Confirmation</p>
                                    </div>
                                    <div className="space-y-4 text-base font-bold border-y border-dashed border-[#D5BDAF]/30 py-8 text-left">
                                        <div className="flex justify-between items-center"><span className="opacity-50 font-black">å®¢æˆ¶å§“å</span><span className="text-lg">{order.name}</span></div>
                                        <div className="flex justify-between items-center"><span className="opacity-50 font-black">é ç´„æ™‚é–“</span><span className="text-[#8E7D6F] font-black text-lg">{order.pickupTime.replace('T',' ')}</span></div>
                                        <div className="flex justify-between items-center"><span className="opacity-50 font-black">è£é£¾å°å¡</span><span>{cardNames[order.cardType]}</span></div>
                                        <div className="flex justify-between items-center"><span className="opacity-50 font-black">é…é€æ–¹å¼</span><span className="text-lg">{order.deliveryMethod}</span></div>
                                        <div className="flex justify-between items-center"><span className="opacity-50 font-black">ä»˜æ¬¾æ–¹å¼</span><span className="text-blue-500 font-black underline underline-offset-8 text-lg">{order.paymentMethod}</span></div>
                                        <div className="text-sm opacity-60 text-right mt-4 bg-[#F9F6F4] p-5 rounded-3xl italic border border-[#F5EBE0]">ğŸ“ {order.deliveryMethod === 'è‡ªå–' ? storeAddress : order.address}</div>
                                    </div>
                                    <div className="space-y-6">
                                        <p className="text-sm font-black text-[#D5BDAF] uppercase tracking-widest border-l-4 border-[#D5BDAF] pl-3">è¨‚è³¼æ˜ç´°å…§å®¹</p>
                                        <div className="space-y-5">
                                            {order.items.map(i => (
                                                <div key={i.id} className="flex justify-between text-xl font-black">
                                                    <div className="flex flex-col">
                                                        <span>â€¢ {i.label} x {i.qty}</span>
                                                        {i.note && <span className="text-sm text-orange-400 font-bold italic mt-1 bg-orange-50 px-2 py-0.5 rounded-lg inline-block self-start">({i.note})</span>}
                                                    </div>
                                                    <span>$ {i.price * i.qty}</span>
                                                </div>
                                            ))}
                                            {/* æ ¸å°æ¸…å–®é¡¯ç¤ºæè¢‹è³‡è¨Š */}
                                            {order.extras.bag && (packing.b6 > 0 || packing.b4 > 0) && (
                                                <div className="space-y-2 pt-2 border-t border-[#F5EBE0]">
                                                    {packing.b6 > 0 && <div className="flex justify-between text-lg font-black text-gray-500"><span>â€¢ å°ˆç”¨ 6 æ¯è¢‹ x {packing.b6}</span><span>$ {packing.b6 * 2}</span></div>}
                                                    {packing.b4 > 0 && <div className="flex justify-between text-lg font-black text-gray-500"><span>â€¢ å°ˆç”¨ 4 æ¯è¢‹ x {packing.b4}</span><span>$ {packing.b4 * 2}</span></div>}
                                                </div>
                                            )}
                                        </div>
                                        {packing.cooler > 0 && (
                                            <div className="bg-blue-50 text-blue-600 p-6 rounded-3xl text-base font-black border border-blue-100 italic flex items-center gap-3 shadow-inner"><Icon name="check" size={20}/> çœŸç©ºåŒ…ç¦åˆ©ï¼šå·²è´ˆé€ä¿å†·è¢‹ x {packing.cooler}</div>
                                        )}
                                    </div>
                                    {(order.paymentMethod === 'åŒ¯æ¬¾' || order.paymentMethod === 'LinePay') && (
                                        <div className="bg-[#FDF8F5] p-8 rounded-[3rem] space-y-6 border border-[#F5EBE0] shadow-inner text-left">
                                            <p className="text-sm font-black text-[#8E7D6F] uppercase border-b border-[#D5BDAF]/20 pb-2 tracking-widest">ä»˜æ¬¾èˆ‡å°å¸³è³‡è¨Š</p>
                                            {order.paymentMethod === 'åŒ¯æ¬¾' ? (
                                                <div className="text-base font-bold space-y-3 text-center">
                                                    <div className="flex justify-between text-sm opacity-60 px-4"><span>éŠ€è¡Œ</span><span>{bankInfo.bankName}</span></div>
                                                    <div className="flex justify-between text-sm opacity-60 px-4"><span>æˆ¶å</span><span>{bankInfo.accountName}</span></div>
                                                    <p className="text-3xl tracking-tighter font-black text-[#8E7D6F] py-5 bg-white rounded-3xl border border-[#F5EBE0] shadow-sm my-4">{bankInfo.accountNumber}</p>
                                                    <div className="text-sm text-red-500 font-black bg-red-50 p-5 rounded-3xl border border-red-100 text-left">âš ï¸ åŒ¯æ¬¾å®Œç•¢å¾Œï¼Œè«‹å›å‚³ã€Œå¸³è™Ÿå¾Œäº”ç¢¼ã€ä»¥ç¢ºèªä»˜æ¬¾ã€‚</div>
                                                </div>
                                            ) : (
                                                <p className="text-lg font-black text-[#8E7D6F] text-center py-4">LinePay ä»˜æ¬¾ï¼šä¸‹å–®å¾Œè«‹æ–¼ LINE ç´¢å–ä»˜æ¬¾é€£çµã€‚</p>
                                            )}
                                        </div>
                                    )}
                                </div>
                                <div className="p-8 bg-[#F9F6F4] flex gap-4 border-t border-[#F5EBE0]">
                                    <button onClick={() => setShowConfirm(false)} className="flex-1 py-6 bg-white rounded-3xl font-black text-[#D5BDAF] border border-[#D5BDAF] text-lg btn-active transition-all">è¿”å›</button>
                                    <button onClick={handleCopyAndSubmit} className="flex-[2] py-6 bg-[#8E7D6F] text-white rounded-3xl font-black shadow-lg flex items-center justify-center gap-4 text-xl btn-active transition-all"><Icon name="copy" size={24}/> è¤‡è£½ä¸¦å›å‚³ LINE</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
